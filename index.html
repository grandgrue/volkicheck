<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>volkicheck - Was ist dir wichtig f√ºr Volketswil?</title>
    <meta name="description" content="Finde heraus, welcher Volketswil-Typ du bist. 30 Fragen zu Themen, die unsere Gemeinde bewegen.">
    <meta property="og:title" content="volkicheck - Was ist dir wichtig?">
    <meta property="og:description" content="Finde heraus, welcher Volketswil-Typ du bist!">
    <meta property="og:url" content="https://volkicheck.grue.ch">
    
    <!-- Favicon: Volketswil Wappen -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 240 280'><path d='m1 1 4.3 182.6c3.1 130.4 227.3 130.4 230.4 0l4.3-182.6z' fill='%23feeb00' stroke='%23000' stroke-width='2'/><path d='m120.5 269.5-13.4-41.7-42.8 9.3 29.5-32.4-29.5-32.4 42.8 9.3 13.4-41.7 13.4 41.7 42.8-9.3-29.5 32.4 29.5 32.4-42.8-9.3z' fill='%23d64229' stroke='%23000'/><path d='m4 128.3 233-0.1 3-127.2H1z' fill='%23fff' stroke='%23000' stroke-width='2'/><path d='m1 1 1.5 63.4h57.5V1zm59 63.4v63.8h60.6V64.4zm60.6 0h60.6V1h-60.6zm60.6 0v63.8h55.8l1.5-63.8z'/></svg>">
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        html { height: 100%; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            overscroll-behavior: none;
            min-height: 100%;
            margin: 0;
        }
        body.no-scroll {
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }
        #root {
            min-height: 100%;
        }
        
        /* Swipe Animationen */
        @keyframes swipeLeft {
            to { transform: translateX(-150%) rotate(-20deg); opacity: 0; }
        }
        @keyframes swipeRight {
            to { transform: translateX(150%) rotate(20deg); opacity: 0; }
        }
        @keyframes swipeUp {
            to { transform: translateY(-150%); opacity: 0; }
        }
        @keyframes swipeDown {
            to { transform: translateY(150%); opacity: 0; }
        }
        @keyframes cardEnter {
            from { transform: scale(0.95) translateY(20px); opacity: 0; }
            to { transform: scale(1) translateY(0); opacity: 1; }
        }
        /* R√ºckw√§rts-Animationen (Karte kommt zur√ºck) */
        @keyframes returnFromLeft {
            from { transform: translateX(-150%) rotate(-20deg); opacity: 0; }
            to { transform: translateX(0) rotate(0); opacity: 1; }
        }
        @keyframes returnFromRight {
            from { transform: translateX(150%) rotate(20deg); opacity: 0; }
            to { transform: translateX(0) rotate(0); opacity: 1; }
        }
        @keyframes returnFromUp {
            from { transform: translateY(-150%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes returnFromDown {
            from { transform: translateY(150%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .swipe-left { animation: swipeLeft 0.4s ease-out forwards; }
        .swipe-right { animation: swipeRight 0.4s ease-out forwards; }
        .swipe-up { animation: swipeUp 0.3s ease-out forwards; }
        .swipe-down { animation: swipeDown 0.3s ease-out forwards; }
        .card-enter { animation: cardEnter 0.3s ease-out; }
        .return-from-left { animation: returnFromLeft 0.4s ease-out; }
        .return-from-right { animation: returnFromRight 0.4s ease-out; }
        .return-from-up { animation: returnFromUp 0.4s ease-out; }
        .return-from-down { animation: returnFromDown 0.4s ease-out; }
        .float-animation { animation: float 2s ease-in-out infinite; }
        .pulse-animation { animation: pulse 2s ease-in-out infinite; }
        
        /* Milestone Zoom Animation - Game Style */
        @keyframes milestoneZoom {
            0% { transform: scale(0.5); opacity: 0; }
            15% { transform: scale(1.2); opacity: 1; }
            70% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.3); opacity: 0; }
        }
        .milestone-zoom {
            animation: milestoneZoom 1.8s ease-out forwards;
        }
        
        /* Touch feedback */
        .touch-feedback:active { transform: scale(0.95); }
        
        /* Gradient Button */
        .btn-gradient {
            background: linear-gradient(135deg, #0D9488 0%, #0891B2 100%);
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // =====================================================
        // KONFIGURATION
        // =====================================================
        
        const API_URL = 'api.php';

        // Volketswil Wappen als SVG-Komponente
        const VolketswilWappen = ({ size = 80, className = "" }) => (
            <svg width={size} height={size * 1.17} viewBox="0 0 241.08 282.39" className={className}>
                <path d="m1 1 4.3469 182.58c3.1049 130.41 227.28 130.41 230.39 0l4.3469-182.58z" fill="#feeb00" stroke="#000" strokeWidth="2"/>
                <path d="m120.54 269.54-13.357-41.726-42.814 9.2951 29.457-32.43-29.457-32.43 42.814 9.2951 13.357-41.726 13.357 41.726 42.814-9.2951-29.457 32.43 29.457 32.43-42.814-9.2951z" fill="#d64229" stroke="#000" strokeWidth="1"/>
                <path d="m4.0299 128.26 233.02-1e-5 3.0299-127.26h-239.08z" fill="#fff" stroke="#000" strokeWidth="2"/>
                <path d="m1.0044 1.0014 1.5 63.438h57.469v-63.438zm58.969 63.438v63.812h60.625v-63.812zm60.625 0h60.625v-63.438h-60.625zm60.625 0v63.812h55.812l1.5312-63.812z"/>
            </svg>
        );
        
        const DIMENSIONS = {
            klima: { name: 'Klima & Natur', color: '#16A34A', emoji: 'üå±' },
            quartier: { name: 'Quartier & Wohnen', color: '#0891B2', emoji: 'üèòÔ∏è' },
            familie: { name: 'Familie & Soziales', color: '#DB2777', emoji: 'üë®‚Äçüë©‚Äçüëß' },
            mobilitaet: { name: 'Mobilit√§t', color: '#EA580C', emoji: 'üö¥' },
            demokratie: { name: 'Demokratie & Finanzen', color: '#7C3AED', emoji: 'ü§ù' }
        };

        const PERSONALITY_TYPES = {
            klima: {
                emoji: 'üå±',
                name: { m: 'Klima-Champion', f: 'Klima-Champion', d: 'Klima-Champion' },
                description: 'Du setzt dich f√ºr Klimaschutz, Biodiversit√§t und nachhaltige Landwirtschaft ein. Gr√ºnr√§ume, B√§ume und regionale Produkte liegen dir am Herzen.',
                color: '#16A34A', bgColor: '#F0FDF4'
            },
            quartier: {
                emoji: 'üèòÔ∏è',
                name: { m: 'Quartier-Gestalter', f: 'Quartier-Gestalterin', d: 'Quartier-Gestalter*in' },
                description: 'Dir liegt die Entwicklung lebenswerter Quartiere am Herzen. Bezahlbarer Wohnraum, sch√∂ne Pl√§tze und ein lebendiges Zentrum sind deine Themen.',
                color: '#0891B2', bgColor: '#ECFEFF'
            },
            familie: {
                emoji: 'üë®‚Äçüë©‚Äçüëß',
                name: { m: 'Familien-Anwalt', f: 'Familien-Anw√§ltin', d: 'Familien-Anw√§lt*in' },
                description: 'Kinder, Familien und √§ltere Menschen stehen bei dir im Mittelpunkt. Sichere Schulwege, Krippenpl√§tze und gute Altersversorgung sind dir wichtig.',
                color: '#DB2777', bgColor: '#FDF2F8'
            },
            mobilitaet: {
                emoji: 'üö¥',
                name: { m: 'Mobilit√§ts-Held', f: 'Mobilit√§ts-Heldin', d: 'Mobilit√§ts-Held*in' },
                description: 'Du willst Volketswil sicherer und nachhaltiger mobil machen. Velowege, besserer √ñV und Tempo-30-Zonen sind deine Priorit√§ten.',
                color: '#EA580C', bgColor: '#FFF7ED'
            },
            demokratie: {
                emoji: 'ü§ù',
                name: { m: 'Demokratie-St√§rker', f: 'Demokratie-St√§rkerin', d: 'Demokratie-St√§rker*in' },
                description: 'Transparenz, Mitbestimmung und faire Finanzen sind dir wichtig. Du willst, dass alle mitreden k√∂nnen und Ressourcen gerecht verteilt werden.',
                color: '#7C3AED', bgColor: '#FAF5FF'
            },
            balanced: {
                emoji: '‚öñÔ∏è',
                name: { m: 'Ausgewogener Denker', f: 'Ausgewogene Denkerin', d: 'Ausgewogene*r Denker*in' },
                description: 'Du w√§gst alle Themen sorgf√§ltig ab und suchst ausgewogene L√∂sungen. Kein einzelnes Thema dominiert ‚Äì du siehst das grosse Ganze.',
                color: '#64748B', bgColor: '#F8FAFC'
            }
        };

        const RESPONSES = [
            { value: 'sehr_wichtig', label: 'Sehr wichtig', emoji: 'üíö', color: '#16A34A' },
            { value: 'wichtig', label: 'Wichtig', emoji: 'üëç', color: '#0891B2' },
            { value: 'egal', label: 'Egal', emoji: 'üòê', color: '#9CA3AF' },
            { value: 'unwichtig', label: 'Unwichtig', emoji: 'üëé', color: '#EF4444' }
        ];

        // =====================================================
        // INTRO SCREEN - mit Wohnort-Frage
        // =====================================================
        
        function IntroScreen({ onStart }) {
            const [showLocationQuestion, setShowLocationQuestion] = useState(false);
            
            if (showLocationQuestion) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-teal-50 via-white to-cyan-50 flex flex-col items-center justify-center p-6">
                        <div className="bg-white rounded-3xl shadow-xl p-8 max-w-md w-full text-center">
                            <div className="mb-4 flex justify-center">
                                <VolketswilWappen size={60} />
                            </div>
                            <h2 className="text-2xl font-bold text-gray-800 mb-2">Wohnst du in Volketswil?</h2>
                            <p className="text-gray-600 mb-6">
                                Die Fragen beziehen sich auf unsere Gemeinde.
                            </p>
                            
                            <div className="space-y-3">
                                <button
                                    onClick={() => onStart(true)}
                                    className="w-full py-4 px-6 rounded-2xl border-2 border-teal-400 bg-teal-50 hover:bg-teal-100 transition text-lg font-medium text-teal-700 touch-feedback"
                                >
                                    Ja, ich wohne in Volketswil
                                </button>
                                <button
                                    onClick={() => onStart(false)}
                                    className="w-full py-4 px-6 rounded-2xl border-2 border-gray-200 hover:border-gray-300 hover:bg-gray-50 transition text-lg font-medium text-gray-600 touch-feedback"
                                >
                                    Nein, aber ich mache trotzdem mit
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }
            
            return (
                <div className="min-h-screen bg-gradient-to-br from-teal-50 via-white to-cyan-50 flex flex-col items-center justify-center p-6">
                    <div className="text-center max-w-md">
                        <div className="mb-4 float-animation flex justify-center">
                            <VolketswilWappen size={80} />
                        </div>
                        <h1 className="text-3xl font-bold text-teal-700 mb-2">volkicheck</h1>
                        <p className="text-gray-600 mb-8">
                            Was ist dir wichtig f√ºr Volketswil?<br/>
                            <span className="text-sm text-gray-500">30 Fragen ¬∑ ca. 3 Minuten</span>
                        </p>
                        
                        <button
                            onClick={() => setShowLocationQuestion(true)}
                            className="btn-gradient text-white px-8 py-4 rounded-full font-semibold text-lg shadow-lg hover:shadow-xl transition-all touch-feedback"
                        >
                            Los geht's!
                        </button>
                        
                        <p className="mt-8 text-xs text-gray-400">
                            Ein Projekt von Michael Gr√ºebler<br/>
                            Kandidat Gemeinderat Volketswil
                        </p>
                    </div>
                </div>
            );
        }

        // =====================================================
        // SWIPE CARD
        // =====================================================
        
        function SwipeCard({ question, onResponse, isAnimating, animationClass }) {
            const cardRef = useRef(null);
            const [dragStart, setDragStart] = useState(null);
            const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });
            const [showHint, setShowHint] = useState(null);

            const handleDragStart = (e) => {
                if (isAnimating) return;
                const point = e.touches ? e.touches[0] : e;
                setDragStart({ x: point.clientX, y: point.clientY });
            };

            const handleDragMove = (e) => {
                if (!dragStart || isAnimating) return;
                const point = e.touches ? e.touches[0] : e;
                const dx = point.clientX - dragStart.x;
                const dy = point.clientY - dragStart.y;
                setDragOffset({ x: dx, y: dy });
                
                // Hint anzeigen basierend auf Richtung
                const threshold = 50;
                if (dx > threshold) setShowHint('wichtig');
                else if (dx < -threshold) setShowHint('unwichtig');
                else if (dy < -threshold) setShowHint('sehr_wichtig');
                else if (dy > threshold) setShowHint('egal');
                else setShowHint(null);
            };

            const handleDragEnd = () => {
                if (!dragStart || isAnimating) return;
                
                const threshold = 80;
                if (dragOffset.x > threshold) onResponse('wichtig');
                else if (dragOffset.x < -threshold) onResponse('unwichtig');
                else if (dragOffset.y < -threshold) onResponse('sehr_wichtig');
                else if (dragOffset.y > threshold) onResponse('egal');
                
                setDragStart(null);
                setDragOffset({ x: 0, y: 0 });
                setShowHint(null);
            };

            const rotation = dragOffset.x * 0.1;
            const opacity = Math.max(0.5, 1 - Math.abs(dragOffset.x) / 300);

            return (
                <div
                    ref={cardRef}
                    className={`absolute inset-0 m-3 bg-white rounded-3xl shadow-2xl p-5 flex flex-col cursor-grab active:cursor-grabbing ${animationClass}`}
                    style={{
                        transform: `translate(${dragOffset.x}px, ${dragOffset.y}px) rotate(${rotation}deg)`,
                        opacity: isAnimating ? 1 : opacity
                    }}
                    onMouseDown={handleDragStart}
                    onMouseMove={handleDragMove}
                    onMouseUp={handleDragEnd}
                    onMouseLeave={handleDragEnd}
                    onTouchStart={handleDragStart}
                    onTouchMove={handleDragMove}
                    onTouchEnd={handleDragEnd}
                >
                    {/* Kategorie */}
                    <div className="flex items-center gap-2 mb-3">
                        <span className="text-xl">{DIMENSIONS[question.dimension]?.emoji}</span>
                        <span className="text-sm text-gray-500">{question.category}</span>
                    </div>
                    
                    {/* Frage */}
                    <div className="flex-1 flex items-center justify-center px-2">
                        <p className="text-lg text-center text-gray-800 leading-relaxed">
                            {question.question_text}
                        </p>
                    </div>
                    
                    {/* Swipe Hints Overlay */}
                    {showHint && (
                        <div className={`absolute inset-0 rounded-3xl flex items-center justify-center pointer-events-none
                            ${showHint === 'sehr_wichtig' ? 'bg-green-500/20' : ''}
                            ${showHint === 'wichtig' ? 'bg-cyan-500/20' : ''}
                            ${showHint === 'egal' ? 'bg-gray-500/20' : ''}
                            ${showHint === 'unwichtig' ? 'bg-red-500/20' : ''}
                        `}>
                            <span className="text-5xl">
                                {RESPONSES.find(r => r.value === showHint)?.emoji}
                            </span>
                        </div>
                    )}
                    
                    {/* Dezenter Swipe-Hinweis */}
                    <div className="text-center text-xs text-gray-300 mt-2">
                        ‚Üê swipe oder tippe auf die Buttons ‚Üí
                    </div>
                </div>
            );
        }

        // =====================================================
        // BUTTON RESPONSES
        // =====================================================
        
        function ResponseButtons({ onResponse, disabled }) {
            // Buttons werden jetzt um die Karte herum platziert
            // Diese Komponente wird nicht mehr verwendet - 
            // stattdessen sind die Buttons direkt im QuestionScreen integriert
            return null;
        }
        
        // Einzelner Richtungs-Button
        function DirectionButton({ response, direction, onResponse, disabled }) {
            const positionClasses = {
                top: 'top-0 left-1/2 -translate-x-1/2 -translate-y-1/2',
                bottom: 'bottom-0 left-1/2 -translate-x-1/2 translate-y-1/2',
                left: 'left-2 top-[30%] -translate-y-1/2',      // H√∂her und etwas nach innen
                right: 'right-2 top-[30%] -translate-y-1/2'     // H√∂her und etwas nach innen
            };
            
            return (
                <button
                    onClick={() => onResponse(response.value)}
                    disabled={disabled}
                    className={`absolute ${positionClasses[direction]} z-10 flex items-center gap-1 py-2 px-2.5 rounded-full shadow-lg transition-all touch-feedback disabled:opacity-50 hover:scale-110 active:scale-95`}
                    style={{ 
                        backgroundColor: 'white',
                        borderWidth: '2px',
                        borderColor: response.color
                    }}
                >
                    <span className="text-base">{response.emoji}</span>
                    <span className="text-xs font-semibold" style={{ color: response.color }}>{response.label}</span>
                </button>
            );
        }

        // =====================================================
        // PROGRESS BAR
        // =====================================================
        
        function ProgressBar({ current, total }) {
            const percent = (current / total) * 100;
            
            return (
                <div className="px-4 py-2">
                    <div className="flex justify-between items-center mb-1">
                        <span className="text-sm text-gray-500">{current} / {total}</span>
                    </div>
                    <div className="h-2 bg-gray-200 rounded-full overflow-hidden">
                        <div 
                            className="h-full bg-gradient-to-r from-teal-400 to-cyan-500 rounded-full transition-all duration-300"
                            style={{ width: `${percent}%` }}
                        />
                    </div>
                </div>
            );
        }
        
        // Milestone Anzeige - inline im Zur√ºck-Bereich
        function MilestoneDisplay({ milestone }) {
            if (!milestone) return null;
            
            return (
                <span 
                    className="milestone-zoom text-xl font-bold"
                    style={{ 
                        color: '#0D9488',
                        textShadow: '0 0 15px rgba(13, 148, 136, 0.4)'
                    }}
                >
                    {milestone}
                </span>
            );
        }

        // =====================================================
        // QUESTION SCREEN
        // =====================================================
        
        function QuestionScreen({ questions, sessionId, onComplete }) {
            const [shuffledQuestions, setShuffledQuestions] = useState([]);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [isAnimating, setIsAnimating] = useState(false);
            const [animationClass, setAnimationClass] = useState('card-enter');
            const [responses, setResponses] = useState({});
            const [responseHistory, setResponseHistory] = useState([]); // Speichert Richtungen f√ºr Zur√ºck-Animation
            const [showMilestone, setShowMilestone] = useState(null);

            // Milestone Definitionen
            const milestones = {
                10: 'üéØ Guter Start!',
                15: '‚ö° Halbzeit!',
                25: 'üî• Fast geschafft!'
            };

            // Fragen beim ersten Render zuf√§llig mischen
            React.useEffect(() => {
                const shuffled = [...questions].sort(() => Math.random() - 0.5);
                setShuffledQuestions(shuffled);
            }, [questions]);

            // Milestone anzeigen wenn erreicht
            React.useEffect(() => {
                if (milestones[currentIndex + 1]) {
                    setShowMilestone(milestones[currentIndex + 1]);
                    setTimeout(() => setShowMilestone(null), 1500);
                }
            }, [currentIndex]);

            const currentQuestion = shuffledQuestions[currentIndex];
            const isLastQuestion = currentIndex === shuffledQuestions.length - 1;

            // Warten bis Fragen gemischt sind
            if (shuffledQuestions.length === 0) {
                return <LoadingScreen message="Fragen werden vorbereitet..." />;
            }

            const handleResponse = async (response) => {
                if (isAnimating) return;
                
                // Animation starten
                setIsAnimating(true);
                const animMap = {
                    'sehr_wichtig': 'swipe-up',
                    'wichtig': 'swipe-right',
                    'egal': 'swipe-down',
                    'unwichtig': 'swipe-left'
                };
                setAnimationClass(animMap[response]);
                
                // Antwort und Richtung speichern
                setResponses(prev => ({ ...prev, [currentQuestion.id]: response }));
                setResponseHistory(prev => [...prev, { questionId: currentQuestion.id, response }]);
                
                // API Call
                try {
                    await fetch(API_URL + '?action=respond', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            session_id: sessionId,
                            question_id: currentQuestion.id,
                            response: response
                        })
                    });
                } catch (e) {
                    console.error('Failed to save response', e);
                }
                
                // N√§chste Frage oder Ende
                setTimeout(() => {
                    if (isLastQuestion) {
                        onComplete(responses);
                    } else {
                        setCurrentIndex(prev => prev + 1);
                        setAnimationClass('card-enter');
                        setIsAnimating(false);
                    }
                }, 350);
            };

            const handleGoBack = () => {
                if (isAnimating || currentIndex === 0) return;
                
                setIsAnimating(true);
                
                // Letzte Antwort aus History holen
                const lastEntry = responseHistory[responseHistory.length - 1];
                
                // R√ºckw√§rts-Animation basierend auf letzter Richtung
                const returnAnimMap = {
                    'sehr_wichtig': 'return-from-up',
                    'wichtig': 'return-from-right',
                    'egal': 'return-from-down',
                    'unwichtig': 'return-from-left'
                };
                
                // Sofort zur√ºck gehen, Animation zeigt woher die Karte kommt
                setCurrentIndex(prev => prev - 1);
                setAnimationClass(returnAnimMap[lastEntry?.response] || 'card-enter');
                
                // History k√ºrzen
                setResponseHistory(prev => prev.slice(0, -1));
                
                setTimeout(() => {
                    setIsAnimating(false);
                }, 400);
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-teal-50 via-white to-cyan-50 flex flex-col">
                    {/* Header */}
                    <div className="p-4 text-center">
                        <h1 className="text-xl font-bold text-teal-700">volkicheck</h1>
                    </div>
                    
                    {/* Progress */}
                    <ProgressBar current={currentIndex + 1} total={shuffledQuestions.length} />
                    
                    {/* Zur√ºck-Link und Milestone */}
                    <div className="flex justify-center items-center h-8">
                        {currentIndex > 0 && !showMilestone ? (
                            <button 
                                onClick={handleGoBack}
                                disabled={isAnimating}
                                className="text-sm text-gray-400 hover:text-teal-600 transition disabled:opacity-50"
                            >
                                ‚Üê zur√ºck
                            </button>
                        ) : (
                            <MilestoneDisplay milestone={showMilestone} />
                        )}
                    </div>
                    
                    {/* Card Container mit Buttons drum herum */}
                    <div className="flex-1 flex items-center justify-center px-4 pt-2 pb-8">
                        <div className="relative w-full max-w-sm" style={{ aspectRatio: '4/5', maxHeight: 'calc(100vh - 220px)' }}>
                            {/* Richtungs-Buttons */}
                            <DirectionButton 
                                response={RESPONSES.find(r => r.value === 'sehr_wichtig')} 
                                direction="top" 
                                onResponse={handleResponse} 
                                disabled={isAnimating} 
                            />
                            <DirectionButton 
                                response={RESPONSES.find(r => r.value === 'egal')} 
                                direction="bottom" 
                                onResponse={handleResponse} 
                                disabled={isAnimating} 
                            />
                            <DirectionButton 
                                response={RESPONSES.find(r => r.value === 'unwichtig')} 
                                direction="left" 
                                onResponse={handleResponse} 
                                disabled={isAnimating} 
                            />
                            <DirectionButton 
                                response={RESPONSES.find(r => r.value === 'wichtig')} 
                                direction="right" 
                                onResponse={handleResponse} 
                                disabled={isAnimating} 
                            />
                            
                            {/* Swipe Card */}
                            {currentQuestion && (
                                <SwipeCard
                                    key={currentQuestion.id}
                                    question={currentQuestion}
                                    onResponse={handleResponse}
                                    isAnimating={isAnimating}
                                    animationClass={animationClass}
                                />
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // =====================================================
        // GENDER SELECTION
        // =====================================================
        
        function GenderScreen({ onSelect }) {
            return (
                <div className="min-h-screen bg-gradient-to-br from-teal-50 via-white to-cyan-50 flex items-center justify-center p-6">
                    <div className="bg-white rounded-3xl shadow-xl p-8 max-w-md w-full text-center">
                        <div className="text-5xl mb-4">üëã</div>
                        <h2 className="text-2xl font-bold text-gray-800 mb-2">Nur noch eine Frage!</h2>
                        <p className="text-gray-600 mb-6">
                            Damit wir dich richtig ansprechen k√∂nnen:
                        </p>
                        
                        <div className="space-y-3">
                            <button
                                onClick={() => onSelect('f')}
                                className="w-full py-4 px-6 rounded-2xl border-2 border-teal-200 hover:border-teal-400 hover:bg-teal-50 transition text-lg font-medium text-gray-700 touch-feedback"
                            >
                                Weiblich
                            </button>
                            
                            <button
                                onClick={() => onSelect('m')}
                                className="w-full py-4 px-6 rounded-2xl border-2 border-teal-200 hover:border-teal-400 hover:bg-teal-50 transition text-lg font-medium text-gray-700 touch-feedback"
                            >
                                M√§nnlich
                            </button>
                            
                            <button
                                onClick={() => onSelect('d')}
                                className="w-full py-4 px-6 rounded-2xl border-2 border-teal-200 hover:border-teal-400 hover:bg-teal-50 transition text-lg font-medium text-gray-700 touch-feedback"
                            >
                                Divers / Keine Angabe
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // =====================================================
        // LOADING SCREEN
        // =====================================================
        
        function LoadingScreen({ message }) {
            return (
                <div className="min-h-screen bg-gradient-to-br from-teal-50 via-white to-cyan-50 flex items-center justify-center">
                    <div className="text-center">
                        <div className="text-5xl mb-4 pulse-animation">üîÆ</div>
                        <p className="text-gray-600">{message || 'Wird geladen...'}</p>
                    </div>
                </div>
            );
        }

        // =====================================================
        // RADAR CHART
        // =====================================================
        
        function RadarChart({ scores, size = 240 }) {
            const center = size / 2;
            const radius = size * 0.36;
            const dims = Object.keys(DIMENSIONS);
            const angleStep = (2 * Math.PI) / dims.length;
            
            const points = dims.map((dim, i) => {
                const angle = i * angleStep - Math.PI / 2;
                const value = (scores[dim] || 0) / 3;
                const x = center + radius * value * Math.cos(angle);
                const y = center + radius * value * Math.sin(angle);
                return { x, y, dim };
            });
            
            const pathD = points.map((p, i) => 
                `${i === 0 ? 'M' : 'L'} ${p.x} ${p.y}`
            ).join(' ') + ' Z';
            
            return (
                <svg width={size} height={size} className="mx-auto">
                    {[0.33, 0.66, 1].map((level, li) => (
                        <polygon
                            key={li}
                            points={dims.map((_, i) => {
                                const angle = i * angleStep - Math.PI / 2;
                                return `${center + radius * level * Math.cos(angle)},${center + radius * level * Math.sin(angle)}`;
                            }).join(' ')}
                            fill="none" stroke="#E5E7EB" strokeWidth="1"
                        />
                    ))}
                    
                    {dims.map((dim, i) => {
                        const angle = i * angleStep - Math.PI / 2;
                        return (
                            <line key={dim}
                                x1={center} y1={center}
                                x2={center + radius * Math.cos(angle)}
                                y2={center + radius * Math.sin(angle)}
                                stroke="#E5E7EB" strokeWidth="1"
                            />
                        );
                    })}
                    
                    <path d={pathD} fill="rgba(13, 148, 136, 0.3)" stroke="#0D9488" strokeWidth="2" />
                    
                    {points.map((p, i) => (
                        <circle key={i} cx={p.x} cy={p.y} r="5"
                            fill={DIMENSIONS[p.dim].color} stroke="white" strokeWidth="2" />
                    ))}
                    
                    {dims.map((dim, i) => {
                        const angle = i * angleStep - Math.PI / 2;
                        const x = center + (radius + 24) * Math.cos(angle);
                        const y = center + (radius + 24) * Math.sin(angle);
                        return (
                            <text key={dim} x={x} y={y} textAnchor="middle" dominantBaseline="middle" fontSize="16">
                                {DIMENSIONS[dim].emoji}
                            </text>
                        );
                    })}
                </svg>
            );
        }

        // =====================================================
        // SHARE IMAGE GENERATOR
        // =====================================================
        
        function ShareImageGenerator({ personality, typeName, scores, comparePercent }) {
            const canvasRef = useRef(null);
            const [imageUrl, setImageUrl] = useState(null);

            useEffect(() => {
                generateImage();
            }, [personality, typeName, scores, comparePercent]);

            const generateImage = () => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                const size = 1080;
                canvas.width = size;
                canvas.height = size;

                // Hintergrund
                const gradient = ctx.createLinearGradient(0, 0, size, size);
                gradient.addColorStop(0, '#F0FDFA');
                gradient.addColorStop(0.5, '#FFFFFF');
                gradient.addColorStop(1, '#ECFEFF');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, size, size);

                // Wappen zeichnen Funktion
                const drawWappen = (x, y, wappenSize) => {
                    ctx.save();
                    ctx.translate(x, y);
                    const scale = wappenSize / 282.39;
                    ctx.scale(scale, scale);
                    
                    ctx.fillStyle = '#feeb00';
                    ctx.strokeStyle = '#000';
                    ctx.lineWidth = 2 / scale;
                    ctx.beginPath();
                    ctx.moveTo(1, 1);
                    ctx.lineTo(5.35, 183.58);
                    ctx.bezierCurveTo(8.45, 313.99, 232.63, 313.99, 235.74, 183.58);
                    ctx.lineTo(240.08, 1);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();
                    
                    ctx.fillStyle = '#d64229';
                    ctx.lineWidth = 1 / scale;
                    ctx.beginPath();
                    ctx.moveTo(120.54, 269.54);
                    ctx.lineTo(107.18, 227.81);
                    ctx.lineTo(64.37, 237.11);
                    ctx.lineTo(93.83, 204.68);
                    ctx.lineTo(64.37, 172.25);
                    ctx.lineTo(107.18, 181.54);
                    ctx.lineTo(120.54, 139.82);
                    ctx.lineTo(133.9, 181.54);
                    ctx.lineTo(176.71, 172.25);
                    ctx.lineTo(147.25, 204.68);
                    ctx.lineTo(176.71, 237.11);
                    ctx.lineTo(133.9, 227.81);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();
                    
                    ctx.fillStyle = '#fff';
                    ctx.lineWidth = 2 / scale;
                    ctx.beginPath();
                    ctx.moveTo(4.03, 128.26);
                    ctx.lineTo(237.05, 128.26);
                    ctx.lineTo(240.08, 1);
                    ctx.lineTo(1, 1);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();
                    
                    ctx.fillStyle = '#000';
                    ctx.beginPath();
                    ctx.moveTo(1, 1);
                    ctx.lineTo(2.5, 64.44);
                    ctx.lineTo(59.97, 64.44);
                    ctx.lineTo(59.97, 1);
                    ctx.closePath();
                    ctx.moveTo(59.97, 64.44);
                    ctx.lineTo(59.97, 128.25);
                    ctx.lineTo(120.6, 128.25);
                    ctx.lineTo(120.6, 64.44);
                    ctx.closePath();
                    ctx.moveTo(120.6, 64.44);
                    ctx.lineTo(181.22, 64.44);
                    ctx.lineTo(181.22, 1);
                    ctx.lineTo(120.6, 1);
                    ctx.closePath();
                    ctx.moveTo(181.22, 64.44);
                    ctx.lineTo(181.22, 128.25);
                    ctx.lineTo(237.03, 128.25);
                    ctx.lineTo(238.56, 64.44);
                    ctx.closePath();
                    ctx.fill();
                    
                    ctx.restore();
                };

                // Header mit Wappen
                drawWappen(size / 2 - 120, 25, 50);
                ctx.fillStyle = '#0D9488';
                ctx.font = 'bold 42px -apple-system, BlinkMacSystemFont, sans-serif';
                ctx.textAlign = 'left';
                ctx.fillText('volkicheck', size / 2 - 55, 62);

                // Karte
                const cardX = 60, cardY = 100, cardW = size - 120, cardH = 900;
                ctx.shadowColor = 'rgba(0,0,0,0.1)';
                ctx.shadowBlur = 30;
                ctx.shadowOffsetY = 10;
                ctx.fillStyle = personality.bgColor;
                ctx.beginPath();
                ctx.roundRect(cardX, cardY, cardW, cardH, 32);
                ctx.fill();
                ctx.shadowColor = 'transparent';

                // Emoji & Name
                ctx.font = '72px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(personality.emoji, size / 2, cardY + 80);
                ctx.fillStyle = personality.color;
                ctx.font = 'bold 44px -apple-system, BlinkMacSystemFont, sans-serif';
                ctx.fillText(typeName, size / 2, cardY + 140);

                // Prozent Text (ohne Hintergrund-Box)
                const percentText = `${comparePercent}% sehen das √§hnlich`;
                ctx.font = 'bold 22px -apple-system, BlinkMacSystemFont, sans-serif';
                ctx.fillStyle = '#0D9488';
                ctx.fillText(percentText, size / 2, cardY + 186);

                // Beschreibung (kompakter)
                ctx.fillStyle = '#4B5563';
                ctx.font = '22px -apple-system, BlinkMacSystemFont, sans-serif';
                const words = personality.description.split(' ');
                let line = '', y = cardY + 235;
                for (const word of words) {
                    const testLine = line + word + ' ';
                    if (ctx.measureText(testLine).width > cardW - 80 && line) {
                        ctx.fillText(line.trim(), size / 2, y);
                        line = word + ' ';
                        y += 28;
                    } else {
                        line = testLine;
                    }
                }
                ctx.fillText(line.trim(), size / 2, y);

                // Trennlinie
                const separatorY = y + 35;
                ctx.strokeStyle = '#E5E7EB';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(cardX + 40, separatorY);
                ctx.lineTo(cardX + cardW - 40, separatorY);
                ctx.stroke();

                // "Deine Top-Themen" Titel
                ctx.fillStyle = '#374151';
                ctx.font = 'bold 26px -apple-system, BlinkMacSystemFont, sans-serif';
                ctx.fillText('Deine Top-Themen', size / 2, separatorY + 40);

                // Top 3 Balken
                const dims = Object.keys(DIMENSIONS);
                const sortedDims = Object.entries(scores)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 3);
                
                const barStartY = separatorY + 65;
                const barHeight = 38;
                const barGap = 15;
                const barMaxWidth = cardW - 100;
                const labelWidth = 160;

                sortedDims.forEach(([dim, score], index) => {
                    const barY = barStartY + index * (barHeight + barGap);
                    const dimInfo = DIMENSIONS[dim];
                    const barWidth = (score / 3) * (barMaxWidth - labelWidth);
                    
                    // Label (Emoji + Name)
                    ctx.font = '22px -apple-system, BlinkMacSystemFont, sans-serif';
                    ctx.fillStyle = '#374151';
                    ctx.textAlign = 'left';
                    ctx.fillText(`${dimInfo.emoji} ${dimInfo.name.split(' ')[0]}`, cardX + 50, barY + 26);
                    
                    // Balken Hintergrund
                    ctx.fillStyle = '#E5E7EB';
                    ctx.beginPath();
                    ctx.roundRect(cardX + 50 + labelWidth, barY, barMaxWidth - labelWidth, barHeight, 8);
                    ctx.fill();
                    
                    // Balken gef√ºllt
                    ctx.fillStyle = dimInfo.color;
                    ctx.beginPath();
                    ctx.roundRect(cardX + 50 + labelWidth, barY, barWidth, barHeight, 8);
                    ctx.fill();
                    
                    // Prozent-Wert
                    ctx.fillStyle = '#FFFFFF';
                    ctx.font = 'bold 18px -apple-system, BlinkMacSystemFont, sans-serif';
                    ctx.textAlign = 'right';
                    ctx.fillText(`${Math.round(score / 3 * 100)}%`, cardX + 45 + labelWidth + barWidth - 10, barY + 25);
                });

                // Radar Chart (noch tiefer positioniert)
                const radarCenterX = size / 2;
                const radarCenterY = barStartY + 3 * (barHeight + barGap) + 195;
                const radarRadius = 100;
                const angleStep = (2 * Math.PI) / dims.length;

                // Achsenlinien
                ctx.strokeStyle = '#D1D5DB';
                ctx.lineWidth = 2;
                dims.forEach((_, i) => {
                    const angle = i * angleStep - Math.PI / 2;
                    ctx.beginPath();
                    ctx.moveTo(radarCenterX, radarCenterY);
                    ctx.lineTo(radarCenterX + radarRadius * Math.cos(angle), radarCenterY + radarRadius * Math.sin(angle));
                    ctx.stroke();
                });

                // Konzentrische Ringe
                for (const level of [0.33, 0.66, 1]) {
                    ctx.beginPath();
                    dims.forEach((_, i) => {
                        const angle = i * angleStep - Math.PI / 2;
                        const x = radarCenterX + radarRadius * level * Math.cos(angle);
                        const y = radarCenterY + radarRadius * level * Math.sin(angle);
                        i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
                    });
                    ctx.closePath();
                    ctx.stroke();
                }

                // Radar-Fl√§che
                ctx.fillStyle = personality.color + '40';
                ctx.strokeStyle = personality.color;
                ctx.lineWidth = 3;
                ctx.beginPath();
                dims.forEach((dim, i) => {
                    const angle = i * angleStep - Math.PI / 2;
                    const value = (scores[dim] || 0) / 3;
                    const x = radarCenterX + radarRadius * value * Math.cos(angle);
                    const y = radarCenterY + radarRadius * value * Math.sin(angle);
                    i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
                });
                ctx.closePath();
                ctx.fill();
                ctx.stroke();

                // Radar Labels (gr√∂ssere Icons mit Text)
                const dimLabels = { 
                    klima: { emoji: 'üå±', name: 'Klima' }, 
                    quartier: { emoji: 'üèòÔ∏è', name: 'Quartier' }, 
                    familie: { emoji: 'üë®‚Äçüë©‚Äçüëß', name: 'Familie' }, 
                    mobilitaet: { emoji: 'üö¥', name: 'Mobilit√§t' }, 
                    demokratie: { emoji: 'ü§ù', name: 'Demokratie' } 
                };
                
                dims.forEach((dim, i) => {
                    const angle = i * angleStep - Math.PI / 2;
                    const labelDist = radarRadius + 50;
                    let x = radarCenterX + labelDist * Math.cos(angle);
                    let y = radarCenterY + labelDist * Math.sin(angle);
                    
                    // Emoji (gr√∂sser)
                    ctx.font = '28px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(dimLabels[dim].emoji, x, y);
                    
                    // Text darunter
                    ctx.font = '18px -apple-system, BlinkMacSystemFont, sans-serif';
                    ctx.fillStyle = '#6B7280';
                    ctx.fillText(dimLabels[dim].name, x, y + 22);
                    ctx.fillStyle = '#374151';
                });

                // Footer (eine Zeile)
                ctx.textAlign = 'center';
                ctx.fillStyle = '#0D9488';
                ctx.font = 'bold 26px -apple-system, BlinkMacSystemFont, sans-serif';
                ctx.fillText('Welcher Typ bist du? Mach den Test auf volkicheck.grue.ch', size / 2, size - 40);

                setImageUrl(canvas.toDataURL('image/png'));
            };

            return (
                <div>
                    <canvas ref={canvasRef} style={{ display: 'none' }} />
                    {imageUrl && (
                        <div className="space-y-3">
                            <img src={imageUrl} alt="Ergebnis" className="w-full rounded-xl shadow-lg" />
                            <a href={imageUrl} download="mein-volkicheck-ergebnis.png"
                                className="block w-full bg-gradient-to-r from-violet-500 to-purple-600 text-white py-3 rounded-full font-semibold text-center">
                                üì• Bild speichern
                            </a>
                        </div>
                    )}
                </div>
            );
        }

        // =====================================================
        // SHARE MODAL
        // =====================================================
        
        function ShareModal({ isOpen, onClose, personality, typeName, scores, comparePercent }) {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50" onClick={onClose}>
                    <div className="bg-white rounded-3xl p-6 max-w-md w-full max-h-[90vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="text-xl font-bold text-gray-800">Ergebnis teilen</h3>
                            <button onClick={onClose} className="text-gray-400 hover:text-gray-600 text-2xl">√ó</button>
                        </div>
                        <p className="text-sm text-gray-600 mb-4">
                            Speichere das Bild und teile es auf Instagram, WhatsApp, oder wo du m√∂chtest!
                        </p>
                        <ShareImageGenerator personality={personality} typeName={typeName} scores={scores} comparePercent={comparePercent} />
                    </div>
                </div>
            );
        }

        // =====================================================
        // CALL TO ACTION COMPONENT
        // =====================================================
        
        function CallToAction({ result }) {
            const isLowScore = result.is_low_score;
            const livesInVolketswil = result.lives_in_volketswil;
            const topStatements = result.top_statements || [];
            
            // Variante A: Volketswiler mit hohem Score
            if (livesInVolketswil && !isLowScore) {
                return (
                    <div className="px-4 pb-6">
                        <div className="bg-gradient-to-br from-teal-600 to-cyan-600 rounded-3xl shadow-xl p-6 max-w-md mx-auto text-white">
                            <h3 className="text-xl font-bold mb-4 text-center">üó≥Ô∏è Deine Stimme z√§hlt!</h3>
                            
                            <p className="text-teal-100 mb-3 text-sm">Dir ist wichtig, dass...</p>
                            
                            <ul className="space-y-2 mb-5">
                                {topStatements.slice(0, 2).map((s, i) => (
                                    <li key={i} className="flex items-start gap-2 text-sm">
                                        <span className="text-teal-200 mt-0.5">‚úì</span>
                                        <span>{s.question_text}</span>
                                    </li>
                                ))}
                            </ul>
                            
                            <p className="text-sm text-teal-100 mb-5 leading-relaxed">
                                Diese Anliegen werden nur umgesetzt, wenn Menschen wie du sich engagieren.
                                <br/><br/>
                                Am <strong className="text-white">8. M√§rz 2025</strong> kannst du etwas bewirken: 
                                W√§hle Michael Gr√ºebler in den Gemeinderat ‚Äì f√ºr ein gr√ºneres, sozialeres Volketswil.
                            </p>
                            
                            <div className="space-y-3">
                                <a 
                                    href="https://www.grue.ch" 
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    className="block w-full bg-white text-teal-700 py-3 rounded-xl font-semibold text-center hover:bg-teal-50 transition"
                                >
                                    üå± Michael Gr√ºebler kennenlernen
                                </a>
                                <a 
                                    href="https://gruene-usterland.ch/kontakt-gruene-schwerzenbach-volketswil/" 
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    className="block w-full bg-teal-500/30 text-white py-3 rounded-xl font-semibold text-center hover:bg-teal-500/50 transition"
                                >
                                    üíö Newsletter / Mitglied werden
                                </a>
                            </div>
                        </div>
                    </div>
                );
            }
            
            // Variante B: Volketswiler mit tiefem Score
            if (livesInVolketswil && isLowScore) {
                return (
                    <div className="px-4 pb-6">
                        <div className="bg-gradient-to-br from-slate-600 to-gray-600 rounded-3xl shadow-xl p-6 max-w-md mx-auto text-white">
                            <h3 className="text-xl font-bold mb-4 text-center">üèõÔ∏è Demokratie lebt von Vielfalt</h3>
                            
                            <p className="text-sm text-gray-200 mb-5 leading-relaxed">
                                Du siehst einige Dinge anders ‚Äì das ist wichtig f√ºr eine lebendige Demokratie.
                                <br/><br/>
                                Falls dir ein Thema besonders am Herzen liegt, engagiere dich in deiner Gemeinde. 
                                Am <strong className="text-white">8. M√§rz 2025</strong> sind Wahlen ‚Äì jede Stimme z√§hlt!
                            </p>
                            
                            <div className="space-y-3">
                                <a 
                                    href="https://www.volketswil.ch" 
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    className="block w-full bg-white text-gray-700 py-3 rounded-xl font-semibold text-center hover:bg-gray-50 transition"
                                >
                                    üèòÔ∏è Gemeinde Volketswil
                                </a>
                                <a 
                                    href="https://www.volketswil.ch/projekte/volketswil-braucht-dich.html/382" 
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    className="block w-full bg-slate-500/30 text-white py-3 rounded-xl font-semibold text-center hover:bg-slate-500/50 transition"
                                >
                                    üó≥Ô∏è Erneuerungswahl 2026
                                </a>
                            </div>
                        </div>
                    </div>
                );
            }
            
            // Variante C: Nicht-Volketswiler
            return (
                <div className="px-4 pb-6">
                    <div className="bg-gradient-to-br from-emerald-600 to-green-600 rounded-3xl shadow-xl p-6 max-w-md mx-auto text-white">
                        <h3 className="text-xl font-bold mb-4 text-center">üåç Danke f√ºrs Mitmachen!</h3>
                        
                        {topStatements.length > 0 && (
                            <>
                                <p className="text-sm text-emerald-100 mb-3">Dir ist wichtig, dass...</p>
                                <ul className="space-y-2 mb-5">
                                    {topStatements.slice(0, 2).map((s, i) => (
                                        <li key={i} className="flex items-start gap-2 text-sm">
                                            <span className="text-emerald-200 mt-0.5">‚úì</span>
                                            <span>{s.question_text}</span>
                                        </li>
                                    ))}
                                </ul>
                            </>
                        )}
                        
                        <p className="text-sm text-emerald-100 mb-5 leading-relaxed">
                            Auch in deiner Gemeinde gibt es bestimmt Menschen, die sich f√ºr √§hnliche Anliegen einsetzen. 
                            Engagiere dich lokal ‚Äì jede Stimme z√§hlt!
                        </p>
                        
                        <div className="space-y-3">
                            <a 
                                href="https://gruene.ch" 
                                target="_blank"
                                rel="noopener noreferrer"
                                className="block w-full bg-white text-emerald-700 py-3 rounded-xl font-semibold text-center hover:bg-emerald-50 transition"
                            >
                                üíö Gr√ºne Schweiz
                            </a>
                            <button 
                                onClick={() => {
                                    navigator.clipboard.writeText('Finde heraus, welcher Typ du bist: https://volkicheck.grue.ch');
                                    alert('Link kopiert! üìã');
                                }}
                                className="block w-full bg-emerald-500/30 text-white py-3 rounded-xl font-semibold text-center hover:bg-emerald-500/50 transition"
                            >
                                üîó volkicheck teilen
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // =====================================================
        // RESULT SCREEN
        // =====================================================
        
        function ResultScreen({ result }) {
            const [showShareModal, setShowShareModal] = useState(false);
            
            const personality = PERSONALITY_TYPES[result.personality_type] || PERSONALITY_TYPES.balanced;
            const typeName = personality.name[result.gender] || personality.name.d;
            
            const sortedDims = Object.entries(result.dimension_scores)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 3);

            const handleShare = (platform) => {
                const text = `Ich bin ${result.gender === 'f' ? 'eine' : result.gender === 'm' ? 'ein' : 'ein*e'} ${typeName}! üéØ Finde heraus, welcher Volketswil-Typ du bist:`;
                const url = 'https://volkicheck.grue.ch';
                
                if (platform === 'whatsapp') {
                    window.open(`https://wa.me/?text=${encodeURIComponent(text + ' ' + url)}`, '_blank');
                } else if (platform === 'image') {
                    setShowShareModal(true);
                } else if (platform === 'copy') {
                    navigator.clipboard.writeText(text + ' ' + url);
                    alert('Link kopiert! üìã');
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-teal-50 via-white to-cyan-50" style={{ paddingBottom: '2rem' }}>
                    <div className="p-4 flex items-center justify-center gap-3">
                        <VolketswilWappen size={32} />
                        <div className="text-center">
                            <h1 className="text-xl font-bold text-teal-700">volkicheck</h1>
                            <p className="text-sm text-gray-500">Dein Ergebnis</p>
                        </div>
                    </div>
                    
                    <div className="px-4 pb-8">
                        <div className="rounded-3xl shadow-xl p-5 max-w-md mx-auto" style={{ backgroundColor: personality.bgColor }}>
                            
                            {result.is_low_score && (
                                <div className="mb-4 p-3 bg-white/70 rounded-xl text-sm text-gray-600 text-center">
                                    üí≠ Du siehst einige Dinge anders als die meisten Teilnehmenden. 
                                    Das ist wertvoll ‚Äì Vielfalt macht die Debatte reicher.
                                </div>
                            )}
                            
                            <div className="text-center mb-5">
                                <div className="text-6xl mb-2 float-animation">{personality.emoji}</div>
                                <h2 className="text-2xl font-bold mb-2" style={{ color: personality.color }}>{typeName}</h2>
                                <p className="text-gray-600 text-sm leading-relaxed px-2">{personality.description}</p>
                            </div>
                            
                            <div className="bg-white/70 rounded-2xl p-4 mb-5">
                                <div className="flex items-center justify-center gap-3">
                                    <div className="text-3xl font-bold text-teal-600">{result.compare_percent}%</div>
                                    <div className="text-sm text-gray-600 text-left">
                                        der Teilnehmenden<br/>sehen das √§hnlich wie du
                                    </div>
                                </div>
                            </div>
                            
                            <div className="bg-white/70 rounded-2xl p-4 mb-5">
                                <h3 className="text-center text-sm font-semibold text-gray-700 mb-1">Dein Profil</h3>
                                <RadarChart scores={result.dimension_scores} />
                                <div className="flex flex-wrap justify-center gap-x-3 gap-y-1 mt-2 text-xs text-gray-500">
                                    {Object.entries(DIMENSIONS).map(([key, dim]) => (
                                        <span key={key}>{dim.emoji} {dim.name}</span>
                                    ))}
                                </div>
                            </div>
                            
                            <div className="bg-white/70 rounded-2xl p-4 mb-5">
                                <h3 className="text-sm font-semibold text-gray-700 mb-3">Deine Top-Themen</h3>
                                <div className="space-y-3">
                                    {sortedDims.map(([dimKey, score]) => {
                                        const dim = DIMENSIONS[dimKey];
                                        return (
                                            <div key={dimKey} className="flex items-center gap-3">
                                                <span className="text-xl w-8">{dim.emoji}</span>
                                                <div className="flex-1">
                                                    <div className="flex justify-between text-sm mb-1">
                                                        <span className="font-medium text-gray-700">{dim.name}</span>
                                                        <span className="text-gray-400">{score.toFixed(1)}/3</span>
                                                    </div>
                                                    <div className="h-2.5 bg-gray-200 rounded-full overflow-hidden">
                                                        <div className="h-full rounded-full" style={{ width: `${(score/3)*100}%`, backgroundColor: dim.color }} />
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                            
                            <div className="text-center">
                                <p className="text-sm text-gray-600 mb-3">Teile dein Ergebnis:</p>
                                <div className="flex flex-wrap justify-center gap-2">
                                    <button onClick={() => handleShare('whatsapp')} className="flex items-center gap-2 px-4 py-2.5 rounded-full text-white font-medium text-sm bg-[#25D366]">
                                        üì± WhatsApp
                                    </button>
                                    <button onClick={() => handleShare('image')} className="flex items-center gap-2 px-4 py-2.5 rounded-full text-white font-medium text-sm bg-[#8B5CF6]">
                                        üñºÔ∏è Als Bild speichern
                                    </button>
                                    <button onClick={() => handleShare('copy')} className="flex items-center gap-2 px-4 py-2.5 rounded-full text-white font-medium text-sm bg-[#64748B]">
                                        üìã Kopieren
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    {/* Call to Action */}
                    <CallToAction result={result} />
                    
                    <div className="text-center pb-8 text-xs text-gray-400">
                        <p>volkicheck.grue.ch</p>
                    </div>

                    <ShareModal 
                        isOpen={showShareModal}
                        onClose={() => setShowShareModal(false)}
                        personality={personality}
                        typeName={typeName}
                        scores={result.dimension_scores}
                        comparePercent={result.compare_percent}
                    />
                </div>
            );
        }

        // =====================================================
        // MAIN APP
        // =====================================================
        
        function App() {
            const [screen, setScreen] = useState('intro'); // intro, loading-start, questions, gender, loading-result, result
            const [questions, setQuestions] = useState([]);
            const [sessionId, setSessionId] = useState(null);
            const [result, setResult] = useState(null);

            const startQuiz = async (livesInVolketswil) => {
                setScreen('loading-start');
                
                try {
                    // Fragen laden
                    const qRes = await fetch(API_URL + '?action=questions');
                    const qData = await qRes.json();
                    setQuestions(qData.questions);
                    
                    // Session starten mit Wohnort-Info
                    const sRes = await fetch(API_URL + '?action=start', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ lives_in_volketswil: livesInVolketswil })
                    });
                    const sData = await sRes.json();
                    setSessionId(sData.session_id);
                    
                    setScreen('questions');
                } catch (e) {
                    console.error('Failed to start', e);
                    alert('Fehler beim Laden. Bitte versuche es erneut.');
                    setScreen('intro');
                }
            };

            const handleQuestionsComplete = () => {
                setScreen('gender');
            };

            const handleGenderSelect = async (gender) => {
                setScreen('loading-result');
                
                try {
                    // Session abschliessen
                    await fetch(API_URL + '?action=complete', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ session_id: sessionId, gender })
                    });
                    
                    // Ergebnis laden
                    const rRes = await fetch(API_URL + '?action=result&sid=' + sessionId);
                    const rData = await rRes.json();
                    setResult(rData);
                    
                    setScreen('result');
                } catch (e) {
                    console.error('Failed to complete', e);
                    alert('Fehler beim Berechnen. Bitte versuche es erneut.');
                }
            };

            // Scroll-Verhalten dynamisch steuern
            React.useEffect(() => {
                if (screen === 'result') {
                    document.body.classList.remove('no-scroll');
                    window.scrollTo(0, 0);
                } else {
                    document.body.classList.add('no-scroll');
                }
            }, [screen]);

            switch (screen) {
                case 'intro':
                    return <IntroScreen onStart={startQuiz} />;
                case 'loading-start':
                    return <LoadingScreen message="Deine Fragen werden vorbereitet..." />;
                case 'loading-result':
                    return <LoadingScreen message="Dein Ergebnis wird berechnet..." />;
                case 'questions':
                    return <QuestionScreen questions={questions} sessionId={sessionId} onComplete={handleQuestionsComplete} />;
                case 'gender':
                    return <GenderScreen onSelect={handleGenderSelect} />;
                case 'result':
                    return <ResultScreen result={result} />;
                default:
                    return <IntroScreen onStart={startQuiz} />;
            }
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
